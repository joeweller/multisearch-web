<!DOCTYPE html>
<html>
  <header>
    <title>multisearch</title>
    <script type="text/javascript" src="./siteData.js"></script>
  </header>
  <body>
    <div>
      <input id="search" type="text" />
    </div>
    <div id="sites"></div>
    <script>
      var searchNode = document.getElementById("search");
      var sitesNode = document.getElementById("sites");

      var processSearch = (event) => {
        let term = searchNode.value;
        let siteConfig = siteData[event.target.id];
        if (term !== undefined && term.length && siteConfig !== undefined) {
          window.open(
            siteConfig["url"].replace(
              "{!TERM}",
              transformTerm(term, siteConfig)
            ),
            "_blank"
          );
        }
      };

      var transformTerm = (term, siteConfig) => {
        // pre-transform
        Object.getOwnPropertyNames(siteConfig["preTransformMap"]).forEach(
          (char) => {
            term = term.replaceAll(char, siteConfig["preTransformMap"][char]);
          }
        );
        //console.log(term);

        // post-transform
        if (
          siteConfig["postTransformFunc"] !== undefined &&
          siteConfig["postTransformFunc"].length
        ) {
          switch (siteConfig["postTransformFunc"]) {
            case "URLENCODE":
              term = encodeURIComponent(term);
              break;
          }
        }
        return term;
      };

      var init = () => {
        console.log(`Document is ready!`);
        Object.getOwnPropertyNames(siteData).forEach((siteId) => {
          let ele = document.createElement("span");
          ele.innerText = siteData[siteId].brand;
          ele.id = siteId;
          ele.addEventListener("click", processSearch);
          sitesNode.appendChild(ele);
        });
      };
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", init());
    </script>
  </body>
</html>
